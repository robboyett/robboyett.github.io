<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rob Boyett</title>
    <link rel="preload" href="https://rsms.me/inter/inter.css" as="style">
    <link href="https://rsms.me/inter/inter.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Hide content until fonts load to prevent FOUT */
        html {
            visibility: hidden;
        }
        
        html.fonts-loaded {
            visibility: visible;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-feature-settings:
                'liga' 1,   /* Standard ligatures */
                'dlig' 1,   /* Discretionary ligatures */
                'calt' 1,   /* Contextual alternates */
                'zero' 1,   /* Slashed zero */
                'kern' 1,   /* Kerning */
                'ss01' 1,   /* Alternate digits */
                'ss02' 0,   /* Disambiguate between similar-looking characters */
                'ss03' 1,   /* Round quotes & commas */
                'cv01' 1,   /* Alternate 1 */
                'cv03' 1,   /* Open six */
                'cv04' 1,   /* Open nine */
                'cv06' 1,   /* Simplified u */
                'cv07' 1,   /* Alternate 6 */
                'cv09' 1,   /* Alternate 8 */
                'cv10' 0,   /* Capital G with spur */
                'cv11' 1,   /* Single-story a */
                'tnum' 1;   /* Tabular figures */
            background-color: #F1F1F1;
            color: #1A1A1A;
            min-height: 100vh;
        }

        @supports (font-variation-settings: normal) {
            body {
                font-family: 'Inter var', 'InterVariable', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            }
        }

        .page {
            padding: 66px 62px;
            min-height: 100vh;
        }

        /* Dim content when dropdown is open */
        .page.menu-open .intro,
        .page.menu-open .contact {
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .intro,
        .contact {
            transition: opacity 0.3s ease;
        }

        /* Preview Box */
        .preview-box {
            position: fixed;
            width: 400px;
            height: 300px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: scale(0.95) translateY(10px);
            transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
            z-index: 1000;
            pointer-events: none;
        }

        .preview-box.visible {
            opacity: 1;
            visibility: visible;
            transform: scale(1) translateY(0);
        }

        .preview-box iframe {
            width: 200%;
            height: 200%;
            border: none;
            transform: scale(0.5);
            transform-origin: top left;
            pointer-events: none;
        }

        .preview-box .loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
            color: #666;
            font-size: 14px;
        }

        .preview-box .loading.with-spinner::after {
            content: '';
            width: 24px;
            height: 24px;
            border: 2px solid #ddd;
            border-top-color: #333;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 12px;
        }

        .preview-box .loading.placeholder {
            font-weight: 600;
            color: #999;
            font-size: 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hidden iframe preloader container */
        .iframe-preloader {
            position: absolute;
            width: 1px;
            height: 1px;
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
            left: -9999px;
        }

        .iframe-preloader iframe {
            width: 800px;
            height: 600px;
        }

        /* Main Content */
        .intro {
            max-width: 854px;
            font-weight: 500;
            font-size: 40px;
            letter-spacing: -1.6px;
            line-height: 1.1;
            margin-top: 300px;
        }

        .intro p {
            margin-bottom: 44px;
        }

        .intro p:last-child {
            margin-bottom: 0;
        }

        /* Contact */
        .contact {
            display: flex;
            flex-wrap: wrap;
            gap: 11px;
            max-width: 983px;
            margin-top: 80px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            font-size: 40px;
            letter-spacing: -1.6px;
            text-decoration: none;
            color: #1A1A1A;
        }

        .contact-item svg {
            width: 33px;
            height: 33px;
            flex-shrink: 0;
        }

        .contact-item.email svg {
            width: 41px;
        }

        .contact-item.email {
            cursor: pointer;
            position: relative;
        }

        .contact-item.email::after {
            content: 'Click to copy';
            position: absolute;
            bottom: 100%;
            left: 0;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0;
            color: white;
            background: #1A1A1A;
            padding: 8px 14px;
            border-radius: 6px;
            opacity: 0;
            transition: opacity 0.2s ease;
            white-space: nowrap;
            pointer-events: none;
        }

        .contact-item.email:hover::after {
            opacity: 1;
        }

        .contact-item.email.copied::after {
            content: 'Copied!';
            background: #1A1A1A;
        }

        button.contact-item.email {
            background: none;
            border: none;
            font-family: inherit;
        }

        .contact-item.medium svg {
            width: 59px;
        }

        /* Thoughts Button - subtle tab at top */
        .thoughts-toggle {
            position: fixed;
            top: 0;
            right: 60px;
            z-index: 1001;
            margin: 0;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 8px 16px 10px;
            border-radius: 0 0 6px 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 12px;
            font-weight: 500;
            color: #666;
            transition: color 0.2s ease, background 0.2s ease;
        }

        .thoughts-toggle:hover {
            color: #1A1A1A;
            background: rgba(255, 255, 255, 1);
        }

        .thoughts-toggle svg {
            width: 14px;
            height: 14px;
        }

        .thoughts-toggle svg path {
            fill: #666;
            transition: fill 0.2s ease;
        }

        .thoughts-toggle:hover svg path {
            fill: #1A1A1A;
        }

        .thoughts-toggle.active {
            background: #1A1A1A;
            color: white;
        }

        .thoughts-toggle.active svg path {
            fill: white;
        }

        /* Thoughts Overlay */
        .thoughts-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 999;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .thoughts-overlay.visible {
            pointer-events: all;
            opacity: 1;
        }

        .thoughts-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(241, 241, 241, 0.85);
        }

        .thoughts-container {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 100px 60px;
        }

        /* Sticky Note Styles */
        .sticky-note {
            position: absolute;
            width: 240px;
            min-height: 140px;
            padding: 32px 20px 20px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 16px;
            font-weight: 500;
            line-height: 1.45;
            color: rgba(0, 0, 0, 0.85);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            transform-origin: center center;
            transition: box-shadow 0.3s ease, transform 0.2s ease;
            cursor: grab;
            user-select: none;
            border-radius: 2px;
        }

        .sticky-note:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
            transform: translateY(-2px);
            z-index: 10;
        }

        .sticky-note.dragging {
            cursor: grabbing;
            z-index: 100;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.22);
            transform: scale(1.02);
        }

        /* Tape strip at top */
        .sticky-note .tape {
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 18px;
            background: rgba(255, 255, 255, 0.65);
            border-radius: 1px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
        }

        /* Flat Colors matching reference */
        .sticky-note.yellow {
            background: #FFF59D;
        }

        .sticky-note.pink {
            background: #F8BBD9;
        }

        .sticky-note.green {
            background: #A5F5C8;
        }

        .sticky-note.blue {
            background: #90CAF9;
        }

        .sticky-note.white {
            background: #FFFFFF;
            border: 1px solid rgba(0, 0, 0, 0.06);
        }

        .sticky-note.orange {
            background: #FFCC80;
        }

        .sticky-note.purple {
            background: #E1BEE7;
        }

        /* Write a note - interactive post-it */
        .sticky-note.write-note {
            background: #FFF59D;
            display: flex;
            flex-direction: column;
            min-height: 180px;
            z-index: 20;
        }

        .sticky-note.write-note .note-prompt {
            color: #666;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-align: center;
            padding: 10px;
        }

        .sticky-note.write-note.editing {
            cursor: default;
        }

        .sticky-note.write-note.editing .note-prompt {
            display: none;
        }

        .sticky-note.write-note .note-form {
            display: none;
            flex-direction: column;
            flex: 1;
            gap: 8px;
        }

        .sticky-note.write-note.editing .note-form {
            display: flex;
        }

        .sticky-note.write-note textarea {
            flex: 1;
            border: none;
            background: transparent;
            resize: none;
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
            color: rgba(0, 0, 0, 0.85);
            outline: none;
            min-height: 80px;
            caret-color: #333;
        }

        .sticky-note.write-note textarea::placeholder {
            color: rgba(0, 0, 0, 0.35);
            font-style: italic;
        }

        .sticky-note.write-note .note-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .sticky-note.write-note button {
            padding: 6px 14px;
            border: none;
            border-radius: 4px;
            font-family: inherit;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .sticky-note.write-note button:hover {
            opacity: 0.8;
        }

        .sticky-note.write-note .cancel-btn {
            background: transparent;
            color: #666;
        }

        .sticky-note.write-note .send-btn {
            background: transparent;
            color: rgba(0, 0, 0, 0.6);
            border: 1.5px solid rgba(0, 0, 0, 0.4);
        }

        .sticky-note.write-note .send-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .sticky-note.write-note .send-btn:hover {
            background: transparent;
            color: rgba(0, 0, 0, 0.85);
            border-color: rgba(0, 0, 0, 0.7);
        }

        .sticky-note.write-note.sent {
            border: 2px solid #81C784;
            background: #E8F5E9;
        }

        .sticky-note.write-note.sent .note-form {
            display: none;
        }

        .sticky-note.write-note.sent .note-prompt {
            display: flex;
            color: #4CAF50;
            font-style: normal;
            font-weight: 600;
        }

        @keyframes noteEntry {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive - Mobile */
        @media (max-width: 768px) {
            .page {
                padding: 40px 24px;
            }

            .intro {
                font-size: 28px;
                margin-top: 200px;
            }

            .intro p {
                margin-bottom: 32px;
            }

            .contact {
                margin-top: 60px;
            }

            .contact-item {
                font-size: 24px;
            }

            .contact-item svg {
                width: 24px;
                height: 24px;
            }

            .contact-item.email svg {
                width: 30px;
            }

            .contact-item.email::after {
                font-size: 12px;
                padding: 6px 10px;
            }

            .contact-item.medium svg {
                width: 42px;
            }

            /* Hide preview on mobile */
            .preview-box {
                display: none !important;
            }

            /* Thoughts button mobile */
            .thoughts-toggle {
                right: 20px;
                padding: 6px 12px 8px;
                font-size: 11px;
            }

            .thoughts-container {
                padding: 80px 20px;
                overflow-y: auto;
            }

            .thoughts-overlay {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .thoughts-container {
                position: relative;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 16px;
                padding: 60px 20px 100px !important;
                min-height: auto;
                height: auto;
            }

            .sticky-note {
                position: relative !important;
                width: calc(100% - 20px) !important;
                max-width: 320px;
                margin: 0 auto !important;
                left: auto !important;
                top: auto !important;
                right: auto !important;
                bottom: auto !important;
                min-height: 120px;
            }

            .sticky-note.write-note {
                order: -1;
                margin-bottom: 8px !important;
            }
        }
    </style>
    
    <!-- Navigation Component -->
    <script src="/components/site-nav.js"></script>
</head>
<body>
    <div class="page">
        <!-- Navigation -->
        <site-nav></site-nav>

        <!-- Intro -->
        <div class="intro">
            <p>Hello, i'm Rob Boyett, a designer. I take products and experiences from simple ideas to market-proved concepts.</p>
            <p>By prototyping based off insights and user needs, verifying them through research, and crafting visual stories to explain them both internally and externally.</p>
        </div>

        <!-- Contact -->
        <div class="contact">
            <button class="contact-item email" id="emailCopy" data-email="rob.boyett@gmail.com">
                <svg viewBox="0 0 41 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M36.5 0H4.5C2.01 0 0.0225 2.01 0.0225 4.5L0 28.5C0 30.99 2.01 33 4.5 33H36.5C38.99 33 41 30.99 41 28.5V4.5C41 2.01 38.99 0 36.5 0ZM36.5 9L20.5 19.125L4.5 9V4.5L20.5 14.625L36.5 4.5V9Z" fill="#1A1A1A"/>
                </svg>
                rob.boyett@gmail.com
            </button>
            <a href="/feed.xml" class="contact-item">
                <svg viewBox="0 0 33 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.125 0C1.84683 0 0 1.84683 0 4.125V28.875C0 31.1532 1.84683 33 4.125 33H28.875C31.1532 33 33 31.1532 33 28.875V4.125C33 1.84683 31.1532 0 28.875 0H4.125ZM8.25 6.1875C8.25 5.51953 8.68359 4.95117 9.28125 4.74609L9.625 4.63086C10.877 4.21875 12.1777 4 13.4883 4H19.5117C20.8223 4 22.123 4.21875 23.375 4.63086L23.7188 4.74609C24.3164 4.95117 24.75 5.51953 24.75 6.1875C24.75 7.05078 24.0508 7.75 23.1875 7.75H9.8125C8.94922 7.75 8.25 7.05078 8.25 6.1875ZM6.1875 11.6875C6.1875 10.8242 6.88672 10.125 7.75 10.125H25.25C26.1133 10.125 26.8125 10.8242 26.8125 11.6875C26.8125 12.5508 26.1133 13.25 25.25 13.25H7.75C6.88672 13.25 6.1875 12.5508 6.1875 11.6875ZM4.125 17.1875C4.125 16.3242 4.82422 15.625 5.6875 15.625H27.3125C28.1758 15.625 28.875 16.3242 28.875 17.1875V26.8125C28.875 27.6758 28.1758 28.375 27.3125 28.375H5.6875C4.82422 28.375 4.125 27.6758 4.125 26.8125V17.1875Z" fill="#1A1A1A"/>
                </svg>
                RSS
            </a>
            <a href="https://www.linkedin.com/in/robboyett/" class="contact-item" target="_blank">
                <svg viewBox="0 0 33 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M30.25 0H2.75C1.23122 0 0 1.23122 0 2.75V30.25C0 31.7688 1.23122 33 2.75 33H30.25C31.7688 33 33 31.7688 33 30.25V2.75C33 1.23122 31.7688 0 30.25 0ZM10.0833 28.0833H5.16667V12.8333H10.0833V28.0833ZM7.625 10.6562C6.00521 10.6562 4.70833 9.35938 4.70833 7.73958C4.70833 6.11979 6.00521 4.82292 7.625 4.82292C9.24479 4.82292 10.5417 6.11979 10.5417 7.73958C10.5417 9.35938 9.24479 10.6562 7.625 10.6562ZM28.0833 28.0833H23.1667V20.625C23.1667 18.7031 23.1302 16.225 20.4844 16.225C17.8021 16.225 17.3958 18.3229 17.3958 20.4896V28.0833H12.4792V12.8333H17.1979V15.125H17.2656C17.9115 13.8125 19.5938 12.3958 22.0938 12.3958C27.0729 12.3958 28.0833 15.6875 28.0833 19.9375V28.0833Z" fill="#1A1A1A"/>
                </svg>
                LinkedIn
            </a>
            <a href="https://medium.com/@robboyett" class="contact-item medium" target="_blank">
                <svg viewBox="0 0 59 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="16.5" cy="16.5" rx="16.5" ry="16.5" fill="#1A1A1A"/>
                    <ellipse cx="42.5" cy="16.5" rx="9" ry="16" fill="#1A1A1A"/>
                    <ellipse cx="56" cy="16.5" rx="3" ry="14" fill="#1A1A1A"/>
                </svg>
                Medium
            </a>
        </div>
    </div>

    <!-- Thoughts Toggle Button -->
    <button class="thoughts-toggle" id="thoughtsToggle" aria-label="Show thoughts">
        <span>Thinking About</span>
    </button>

    <!-- Thoughts Overlay -->
    <div class="thoughts-overlay" id="thoughtsOverlay">
        <div class="thoughts-backdrop"></div>
        <div class="thoughts-container" id="thoughtsContainer">
            <!-- Sticky notes loaded from thoughts.xml -->
        </div>
    </div>

    <!-- Preview Box -->
    <div class="preview-box" id="previewBox">
        <div class="loading" id="previewLoading">Loading preview</div>
        <iframe id="previewFrame" src="about:blank"></iframe>
        <img id="previewImage" src="" alt="Preview" style="display: none; width: 100%; height: 100%; object-fit: cover;" />
    </div>

    <!-- Hidden iframe preloader for fast previews -->
    <div class="iframe-preloader" id="iframePreloader"></div>

    <script>
        const previewBox = document.getElementById('previewBox');
        const previewFrame = document.getElementById('previewFrame');
        const previewLoading = document.getElementById('previewLoading');
        const iframePreloader = document.getElementById('iframePreloader');
        const page = document.querySelector('.page');
        const siteNav = document.querySelector('site-nav');

        // Cache for preloaded iframes
        const preloadedFrames = new Map();
        let currentPreviewUrl = null;
        let hideTimeout = null;

        // Handle menu open/close events from site-nav component
        siteNav.addEventListener('menu-open', () => {
            page.classList.add('menu-open');
            // Preload all internal previews when menu opens
            preloadPreviews();
        });

        siteNav.addEventListener('menu-close', () => {
            page.classList.remove('menu-open');
            hidePreview();
        });

        // When journal entries are loaded, attach preview handlers
        siteNav.addEventListener('entries-loaded', (e) => {
            const entries = e.detail.entries;
            entries.forEach(({ element: link }) => {
                // Add hover events for preview
                link.addEventListener('mouseenter', (e) => {
                    showPreview(link, e);
                    positionPreviewAtCursor(e);
                });
                link.addEventListener('mousemove', (e) => {
                    positionPreviewAtCursor(e);
                });
                link.addEventListener('mouseleave', hidePreview);
            });
        });

        // Preload internal page previews
        function preloadPreviews() {
            const menuItems = siteNav.getMenuItems();
            
            menuItems.forEach(item => {
                const url = item.dataset.preview;
                if (url && !preloadedFrames.has(url)) {
                    const iframe = document.createElement('iframe');
                    iframe.src = url;
                    iframe.setAttribute('loading', 'lazy');
                    iframePreloader.appendChild(iframe);
                    
                    iframe.onload = () => {
                        preloadedFrames.set(url, true);
                    };
                }
            });
        }

        // Track which URLs have been loaded and their screenshot URLs
        const loadedUrls = new Map(); // url -> screenshotUrl for external, true for internal
        const previewImage = document.getElementById('previewImage');
        let currentImageUrl = null;
        
        // Check if URL is external
        function isExternalUrl(url) {
            if (!url || url === '#') return false;
            try {
                const urlObj = new URL(url, window.location.origin);
                return urlObj.origin !== window.location.origin;
            } catch {
                return false;
            }
        }
        
        // Get Microlink screenshot URL
        function getMicrolinkScreenshot(url) {
            return `https://api.microlink.io/?url=${encodeURIComponent(url)}&screenshot=true&meta=false&embed=screenshot.url`;
        }

        // Track current preview type
        let currentPreviewType = null; // 'iframe', 'image', or 'placeholder'

        // Show preview on hover
        function showPreview(item, e) {
            const url = item.dataset.preview;
            const placeholder = item.dataset.previewPlaceholder;
            
            clearTimeout(hideTimeout);

            // Always reset and hide all preview types first
            previewLoading.classList.remove('with-spinner', 'placeholder');
            previewLoading.style.display = 'none';
            previewFrame.style.display = 'none';
            previewImage.style.display = 'none';

            if (placeholder) {
                // Show placeholder for items without real preview
                previewLoading.textContent = placeholder;
                previewLoading.classList.add('placeholder');
                previewLoading.style.display = 'flex';
                currentPreviewUrl = null;
                currentImageUrl = null;
                currentPreviewType = 'placeholder';
            } else if (url && isExternalUrl(url)) {
                // External URL - use Microlink screenshot
                const screenshotUrl = getMicrolinkScreenshot(url);
                currentPreviewType = 'image';
                
                // Always update the image src when switching URLs
                if (currentImageUrl !== screenshotUrl) {
                    currentImageUrl = screenshotUrl;
                    
                    if (loadedUrls.has(url)) {
                        // Already cached - just update src and show
                        previewImage.src = screenshotUrl;
                        previewLoading.style.display = 'none';
                        previewImage.style.display = 'block';
                    } else {
                        // New URL - show loading state
                        previewLoading.textContent = 'Loading preview';
                        previewLoading.classList.add('with-spinner');
                        previewLoading.style.display = 'flex';
                        
                        // Load screenshot
                        previewImage.onload = () => {
                            loadedUrls.set(url, screenshotUrl);
                            if (currentImageUrl === screenshotUrl) {
                                previewLoading.style.display = 'none';
                                previewImage.style.display = 'block';
                            }
                        };
                        previewImage.onerror = () => {
                            if (currentImageUrl === screenshotUrl) {
                                previewLoading.textContent = 'External Link ↗';
                                previewLoading.classList.remove('with-spinner');
                                previewLoading.classList.add('placeholder');
                            }
                        };
                        previewImage.src = screenshotUrl;
                    }
                } else {
                    // Same URL - show immediately
                    previewLoading.style.display = 'none';
                    previewImage.style.display = 'block';
                }
                currentPreviewUrl = url;
            } else if (url) {
                // Internal URL - use iframe
                currentImageUrl = null;
                currentPreviewType = 'iframe';
                
                if (currentPreviewUrl === url && loadedUrls.has(url)) {
                    // Same URL already loaded - show immediately
                    previewLoading.style.display = 'none';
                    previewFrame.style.display = 'block';
                } else {
                    // Different or new URL - show loading state
                    previewLoading.textContent = 'Loading preview';
                    previewLoading.classList.add('with-spinner');
                    previewLoading.style.display = 'flex';
                    
                    if (currentPreviewUrl !== url) {
                        // Load the preview
                        currentPreviewUrl = url;
                        previewFrame.src = url;
                    }
                    
                    previewFrame.onload = () => {
                        loadedUrls.set(url, true);
                        if (currentPreviewUrl === url) {
                            previewLoading.style.display = 'none';
                            previewFrame.style.display = 'block';
                        }
                    };
                }
            } else {
                // No preview available
                return;
            }

            // Position the preview box
            positionPreview(item);
            previewBox.classList.add('visible');
        }

        // Store current mouse position
        let mouseX = 0;
        let mouseY = 0;

        // Position preview box following the cursor
        function positionPreviewAtCursor(e) {
            const boxWidth = 400;
            const boxHeight = 300;
            const offsetX = 20; // Distance from cursor
            const offsetY = 10;
            const padding = 20;

            mouseX = e.clientX;
            mouseY = e.clientY;

            // Default: position to the right and below cursor
            let left = mouseX + offsetX;
            let top = mouseY + offsetY;

            // If it would go off the right edge, position to the left of cursor
            if (left + boxWidth > window.innerWidth - padding) {
                left = mouseX - boxWidth - offsetX;
            }

            // If it would go off the left edge, keep it at minimum padding
            if (left < padding) {
                left = padding;
            }

            // If it would go off the bottom, position above cursor
            if (top + boxHeight > window.innerHeight - padding) {
                top = mouseY - boxHeight - offsetY;
            }

            // If it would go off the top, keep at minimum padding
            if (top < padding) {
                top = padding;
            }

            previewBox.style.left = `${left}px`;
            previewBox.style.top = `${top}px`;
        }

        // Initial position (fallback)
        function positionPreview(item) {
            const rect = item.getBoundingClientRect();
            const boxWidth = 400;
            const boxHeight = 300;
            const padding = 20;

            let left = rect.right + padding;
            let top = rect.top;

            if (left + boxWidth > window.innerWidth - padding) {
                left = rect.left - boxWidth - padding;
            }

            if (left < padding) {
                left = Math.max(padding, (window.innerWidth - boxWidth) / 2);
            }

            if (top + boxHeight > window.innerHeight - padding) {
                top = window.innerHeight - boxHeight - padding;
            }
            if (top < padding) {
                top = padding;
            }

            previewBox.style.left = `${left}px`;
            previewBox.style.top = `${top}px`;
        }

        // Hide preview
        function hidePreview() {
            hideTimeout = setTimeout(() => {
                previewBox.classList.remove('visible');
            }, 100);
        }

        // Note: Hover events for menu items are attached in loadJournalEntries()

        // Keep preview visible when hovering over it
        previewBox.addEventListener('mouseenter', () => {
            clearTimeout(hideTimeout);
        });

        previewBox.addEventListener('mouseleave', hidePreview);

        // Email copy to clipboard
        const emailButton = document.getElementById('emailCopy');
        emailButton.addEventListener('click', async () => {
            const email = emailButton.dataset.email;
            try {
                await navigator.clipboard.writeText(email);
                emailButton.classList.add('copied');
                setTimeout(() => {
                    emailButton.classList.remove('copied');
                }, 2000);
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = email;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                emailButton.classList.add('copied');
                setTimeout(() => {
                    emailButton.classList.remove('copied');
                }, 2000);
            }
        });

        // Wait for Inter font to load before showing page
        if (document.fonts && document.fonts.ready) {
            document.fonts.ready.then(() => {
                document.documentElement.classList.add('fonts-loaded');
            });
        } else {
            // Fallback for browsers without Font Loading API
            document.documentElement.classList.add('fonts-loaded');
        }

        // Thoughts / Sticky Notes Feature
        const thoughtsToggle = document.getElementById('thoughtsToggle');
        const thoughtsOverlay = document.getElementById('thoughtsOverlay');
        const thoughtsContainer = document.getElementById('thoughtsContainer');
        let thoughtsLoaded = false;
        let thoughtsOpen = false;
        let loadedAtMobile = null;

        // Toggle thoughts overlay
        thoughtsToggle.addEventListener('click', () => {
            thoughtsOpen = !thoughtsOpen;
            if (thoughtsOpen) {
                showThoughts();
            } else {
                hideThoughts();
            }
        });

        // Close when clicking backdrop
        thoughtsOverlay.addEventListener('click', (e) => {
            if (e.target.classList.contains('thoughts-backdrop')) {
                thoughtsOpen = false;
                hideThoughts();
            }
        });

        // Close with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && thoughtsOpen) {
                thoughtsOpen = false;
                hideThoughts();
            }
        });

        function showThoughts() {
            thoughtsOverlay.classList.add('visible');
            thoughtsToggle.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Check if we need to reload due to viewport size change
            const isMobile = window.innerWidth <= 768;
            if (!thoughtsLoaded || loadedAtMobile !== isMobile) {
                loadThoughts();
                loadedAtMobile = isMobile;
            }
        }

        function hideThoughts() {
            thoughtsOverlay.classList.remove('visible');
            thoughtsToggle.classList.remove('active');
            document.body.style.overflow = '';
        }

        async function loadThoughts() {
            try {
                const response = await fetch('/thoughts.xml');
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(xmlText, 'text/xml');
                const thoughts = xml.querySelectorAll('thought');
                
                thoughtsContainer.innerHTML = '';
                
                thoughts.forEach((thought, index) => {
                    const color = thought.getAttribute('color') || 'yellow';
                    const text = thought.querySelector('text').textContent;
                    
                    const note = document.createElement('div');
                    note.className = `sticky-note ${color}`;
                    note.innerHTML = `
                        <div class="tape"></div>
                        ${text}
                    `;
                    
                    // Position notes in an ad-hoc scattered pattern (desktop only)
                    if (window.innerWidth > 768) {
                        const position = getAdHocPosition(index, thoughts.length);
                        note.style.left = position.x + '%';
                        note.style.top = position.y + '%';
                    }
                    
                    // Stagger animation entry
                    note.style.opacity = '0';
                    note.style.animation = `noteEntry 0.4s ease ${index * 0.08}s forwards`;
                    
                    // Make note draggable
                    makeDraggable(note);
                    
                    thoughtsContainer.appendChild(note);
                });
                
                // Add the "write me a note" post-it
                addWriteNotePostIt(thoughts.length);
                
                thoughtsLoaded = true;
            } catch (error) {
                console.error('Error loading thoughts:', error);
                thoughtsContainer.innerHTML = '<div class="sticky-note yellow" style="position: relative; margin: 40px auto;">No thoughts yet...</div>';
                addWriteNotePostIt(0);
            }
        }

        // Add interactive "write me a note" post-it
        function addWriteNotePostIt(index) {
            const note = document.createElement('div');
            note.className = 'sticky-note write-note editing';
            note.innerHTML = `
                <div class="tape"></div>
                <div class="note-prompt">✓ Sent!</div>
                <form class="note-form" action="https://formspree.io/f/xojarkpa" method="POST">
                    <textarea name="message" placeholder="What are you thinking about?" required autofocus></textarea>
                    <div class="note-actions">
                        <button type="submit" class="send-btn">Send</button>
                    </div>
                </form>
            `;
            
            // Position it in bottom right area (desktop only, using left/top so dragging works)
            if (window.innerWidth > 768) {
                note.style.left = '70%';
                note.style.top = '55%';
            }
            
            // Animation
            note.style.opacity = '0';
            note.style.animation = `noteEntry 0.4s ease ${index * 0.08}s forwards`;
            
            const prompt = note.querySelector('.note-prompt');
            const form = note.querySelector('.note-form');
            const textarea = note.querySelector('textarea');
            
            // Make it draggable like other notes, but not when interacting with form
            makeDraggable(note);
            
            // Prevent drag when clicking on form elements
            form.addEventListener('mousedown', (e) => {
                e.stopPropagation();
            });
            form.addEventListener('touchstart', (e) => {
                e.stopPropagation();
            }, { passive: true });
            
            // Click anywhere on the note to focus textarea
            note.addEventListener('click', (e) => {
                if (!e.target.closest('.note-actions')) {
                    textarea.focus();
                }
            });
            
            // Handle form submission
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = note.querySelector('.send-btn');
                const messageText = textarea.value;
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0';
                
                try {
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: new FormData(form),
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    if (response.ok) {
                        // Clear and animate "Thanks" letter by letter
                        textarea.value = '';
                        textarea.readOnly = true;
                        
                        const thanksText = 'Thanks ✓';
                        let i = 0;
                        const typeInterval = setInterval(() => {
                            if (i < thanksText.length) {
                                textarea.value += thanksText[i];
                                i++;
                            } else {
                                clearInterval(typeInterval);
                                
                                // Wait, then clear and reset
                                setTimeout(() => {
                                    textarea.value = '';
                                    textarea.readOnly = false;
                                    submitBtn.disabled = false;
                                    submitBtn.style.opacity = '1';
                                    textarea.focus();
                                }, 1500);
                            }
                        }, 80);
                    } else {
                        throw new Error('Failed to send');
                    }
                } catch (error) {
                    textarea.value = 'Error - try again';
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    setTimeout(() => {
                        textarea.value = messageText;
                    }, 2000);
                }
            });
            
            // Prevent drag on this note when editing
            note.addEventListener('mousedown', (e) => {
                if (note.classList.contains('editing')) {
                    e.stopPropagation();
                }
            });
            
            thoughtsContainer.appendChild(note);
        }

        // Generate ad-hoc positions for sticky notes
        function getAdHocPosition(index, total) {
            // Create a scattered but readable layout - 3 columns, tighter spacing
            const positions = [
                { x: 5, y: 2 },
                { x: 35, y: 4 },
                { x: 65, y: 3 },
                { x: 8, y: 28 },
                { x: 38, y: 26 },
                { x: 68, y: 25 },
                { x: 5, y: 52 },
                { x: 35, y: 54 },
                { x: 65, y: 52 },
            ];
            
            // Use predefined positions, with fallback for more notes
            if (index < positions.length) {
                return positions[index];
            }
            
            // Generate additional positions if more notes than predefined
            const row = Math.floor(index / 3);
            const col = index % 3;
            return {
                x: 5 + (col * 30),
                y: 2 + (row * 26)
            };
        }

        // Make sticky notes draggable
        function makeDraggable(element) {
            let isDragging = false;
            let startX, startY, initialX, initialY;

            element.addEventListener('mousedown', startDrag);
            element.addEventListener('touchstart', startDrag, { passive: false });

            function startDrag(e) {
                e.preventDefault();
                isDragging = true;
                element.classList.add('dragging');

                // Get the current position
                const rect = element.getBoundingClientRect();
                const containerRect = thoughtsContainer.getBoundingClientRect();
                
                // Convert to absolute positioning if using percentage
                element.style.left = (rect.left - containerRect.left) + 'px';
                element.style.top = (rect.top - containerRect.top) + 'px';

                if (e.type === 'touchstart') {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                } else {
                    startX = e.clientX;
                    startY = e.clientY;
                }

                initialX = rect.left - containerRect.left;
                initialY = rect.top - containerRect.top;

                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('touchend', stopDrag);
            }

            function drag(e) {
                if (!isDragging) return;
                e.preventDefault();

                let currentX, currentY;
                if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                } else {
                    currentX = e.clientX;
                    currentY = e.clientY;
                }

                const deltaX = currentX - startX;
                const deltaY = currentY - startY;

                element.style.left = (initialX + deltaX) + 'px';
                element.style.top = (initialY + deltaY) + 'px';
            }

            function stopDrag() {
                isDragging = false;
                element.classList.remove('dragging');
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('touchend', stopDrag);
            }
        }
    </script>

    <!-- Analytics -->
    <script async defer src="https://scripts.withcabin.com/hello.js"></script>
</body>
</html>
